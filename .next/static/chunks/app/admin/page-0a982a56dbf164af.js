(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{3073:(e,r,s)=>{Promise.resolve().then(s.bind(s,5782))},3941:(e,r,s)=>{"use strict";s.d(r,{N:()=>n});var t=s(2373),a=s(5704);let i=a.env.NEXT_PUBLIC_SUPABASE_URL||"https://rdisefatytjkgnqrbsqx.supabase.co",l=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"sb_publishable_ft9Zonad32kpGyxeJBry9w_GaNtVCa3",n=(0,t.UU)(i,l)},5782:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>n});var t=s(5155),a=s(2115),i=s(5919),l=s(5704);function n(){let[e,r]=(0,a.useState)(!1),[s,n]=(0,a.useState)(""),[c,o]=(0,a.useState)("menu"),[d,u]=(0,a.useState)([]),[m,g]=(0,a.useState)([]),[p,x]=(0,a.useState)([]),[h,b]=(0,a.useState)(!1),[f,y]=(0,a.useState)(null),[j,w]=(0,a.useState)(!1),[N,v]=(0,a.useState)("idle"),[k,_]=(0,a.useState)(null);(0,a.useEffect)(()=>{"true"===localStorage.getItem("admin_authenticated")&&(r(!0),E())},[]);let E=async()=>{b(!0);try{let[e,r,s]=await Promise.all([(0,i.gL)(),(0,i.NG)(),(0,i.fb)()]);u(e),g(r),x(s)}catch(e){console.error("Erreur lors du chargement:",e),alert("Erreur lors du chargement des donn\xe9es")}finally{b(!1)}},C=async e=>{try{j&&f?await (0,i.x2)(e):f&&await (0,i.q2)(f.id,e),await E(),y(null),w(!1),D("\xc9l\xe9ment sauvegard\xe9 ! Mise \xe0 jour du site en cours...","success"),await P()}catch(e){console.error("Erreur:",e),D("Erreur lors de la sauvegarde","error")}},S=async e=>{if(confirm("\xcates-vous s\xfbr de vouloir supprimer cet \xe9l\xe9ment ?"))try{await (0,i.ax)(e),await E(),D("\xc9l\xe9ment supprim\xe9 ! Mise \xe0 jour du site en cours...","success"),await P()}catch(e){console.error("Erreur:",e),D("Erreur lors de la suppression","error")}},q=async e=>{try{j&&f?await (0,i.wW)(e):f&&await (0,i.R2)(f.id,e),await E(),y(null),w(!1),D("Boisson sauvegard\xe9e ! Mise \xe0 jour du site en cours...","success"),await P()}catch(e){console.error("Erreur:",e),D("Erreur lors de la sauvegarde","error")}},V=async e=>{if(confirm("\xcates-vous s\xfbr de vouloir supprimer cet \xe9l\xe9ment ?"))try{await (0,i.Vd)(e),await E(),D("Boisson supprim\xe9e ! Mise \xe0 jour du site en cours...","success"),await P()}catch(e){console.error("Erreur:",e),D("Erreur lors de la suppression","error")}},L=async e=>{try{j&&f?await (0,i.a1)(e):f&&await (0,i.TW)(f.id,e),await E(),y(null),w(!1),D("Image sauvegard\xe9e ! Mise \xe0 jour du site en cours...","success"),await P()}catch(e){console.error("Erreur:",e),D("Erreur lors de la sauvegarde","error")}},M=async e=>{if(confirm("\xcates-vous s\xfbr de vouloir supprimer cette image ?"))try{await (0,i.XR)(e),await E(),D("Image supprim\xe9e ! Mise \xe0 jour du site en cours...","success"),await P()}catch(e){console.error("Erreur:",e),D("Erreur lors de la suppression","error")}},A=async e=>{var r;let s=null==(r=e.target.files)?void 0:r[0];if(s)try{b(!0);let e="gallery/".concat(Date.now(),"_").concat(s.name),r=await (0,i.V6)(s,e);f?await L({...f,src:r}):await L({src:r,alt:s.name}),D("Image upload\xe9e avec succ\xe8s !","success")}catch(e){console.error("Erreur lors de l'upload:",e),D("Erreur lors de l'upload: ".concat(e instanceof Error?e.message:"Erreur inconnue"),"error")}finally{b(!1)}},P=async()=>{v("rebuilding");try{let e=l.env.NEXT_PUBLIC_VERCEL_DEPLOY_HOOK_URL;if(!e)throw Error("URL du webhook Vercel non configur\xe9e. Veuillez configurer NEXT_PUBLIC_VERCEL_DEPLOY_HOOK_URL dans les variables d'environnement.");let r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"}});if(!r.ok){let e=await r.text();throw Error(e||"Erreur lors du d\xe9clenchement du rebuild")}v("success"),D("Le site est en cours de mise \xe0 jour. Les changements seront visibles dans 2-3 minutes.","success"),setTimeout(()=>v("idle"),5e3)}catch(e){console.error("Erreur rebuild:",e),v("error"),D("Erreur lors du rebuild: ".concat(e instanceof Error?e.message:"Erreur inconnue"),"error"),setTimeout(()=>v("idle"),5e3)}},D=(e,r)=>{_({message:e,type:r}),setTimeout(()=>_(null),5e3)};return e?h?(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-xl",children:"Chargement..."})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,t.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex justify-between items-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Administration - Le Savor\xe9"}),(0,t.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,t.jsx)("button",{onClick:P,disabled:"rebuilding"===N,className:"px-4 py-2 rounded-lg text-white ".concat("rebuilding"===N?"bg-gray-400 cursor-not-allowed":"success"===N?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"),children:"rebuilding"===N?"Mise \xe0 jour...":"Mettre \xe0 jour le site"}),(0,t.jsx)("button",{onClick:()=>{r(!1),localStorage.removeItem("admin_authenticated")},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"D\xe9connexion"})]})]})}),k&&(0,t.jsx)("div",{className:"fixed top-4 right-4 z-50 animate-in slide-in-from-top-5",children:(0,t.jsx)("div",{className:"px-6 py-4 rounded-lg shadow-lg text-white ".concat("success"===k.type?"bg-green-600":"error"===k.type?"bg-red-600":"bg-blue-600"),children:k.message})}),(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[(0,t.jsxs)("div",{className:"flex gap-4 mb-6 border-b",children:[(0,t.jsx)("button",{onClick:()=>o("menu"),className:"px-4 py-2 ".concat("menu"===c?"border-b-2 border-blue-600 font-semibold":""),children:"Menu"}),(0,t.jsx)("button",{onClick:()=>o("drinks"),className:"px-4 py-2 ".concat("drinks"===c?"border-b-2 border-blue-600 font-semibold":""),children:"Boissons"}),(0,t.jsx)("button",{onClick:()=>o("gallery"),className:"px-4 py-2 ".concat("gallery"===c?"border-b-2 border-blue-600 font-semibold":""),children:"Galerie"})]}),"menu"===c&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"\xc9l\xe9ments du Menu"}),(0,t.jsx)("button",{onClick:()=>{y({id:"",name:"",description:"",price:0,category:"",tags:[]}),w(!0)},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"+ Ajouter"})]}),(0,t.jsx)("div",{className:"grid gap-4",children:d.map(e=>(0,t.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[e.category," - ",e.price," CHF"]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>{y(e),w(!1)},className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Modifier"}),(0,t.jsx)("button",{onClick:()=>S(e.id),className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700",children:"Supprimer"})]})]},e.id))})]}),"drinks"===c&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Boissons"}),(0,t.jsx)("button",{onClick:()=>{y({id:"",name:"",description:"",price:0,category:"cocktail"}),w(!0)},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"+ Ajouter"})]}),(0,t.jsx)("div",{className:"grid gap-4",children:m.map(e=>(0,t.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[e.category," - ",e.price," CHF"]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>{y(e),w(!1)},className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Modifier"}),(0,t.jsx)("button",{onClick:()=>V(e.id),className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700",children:"Supprimer"})]})]},e.id))})]}),"gallery"===c&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Images de la Galerie"}),(0,t.jsx)("button",{onClick:()=>{y({id:"",src:"",alt:""}),w(!0)},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"+ Ajouter"})]}),(0,t.jsx)("div",{className:"grid gap-4",children:p.map(e=>(0,t.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold",children:e.alt}),(0,t.jsx)("p",{className:"text-sm text-gray-600 truncate max-w-md",children:e.src})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>{y(e),w(!1)},className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Modifier"}),(0,t.jsx)("button",{onClick:()=>M(e.id),className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700",children:"Supprimer"})]})]},e.id))})]}),f&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold mb-4",children:[j?"Ajouter":"Modifier"," ","menu"===c?"un \xe9l\xe9ment du menu":"drinks"===c?"une boisson":"une image"]}),"menu"===c&&"name"in f&&(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault();let r=new FormData(e.currentTarget);C({name:r.get("name"),description:r.get("description"),price:parseFloat(r.get("price")),category:r.get("category"),tags:[]})},className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nom"}),(0,t.jsx)("input",{type:"text",name:"name",defaultValue:f.name,className:"w-full px-4 py-2 border rounded-lg",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Description"}),(0,t.jsx)("textarea",{name:"description",defaultValue:f.description,className:"w-full px-4 py-2 border rounded-lg",rows:3})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Prix (CHF)"}),(0,t.jsx)("input",{type:"number",name:"price",step:"0.01",defaultValue:f.price,className:"w-full px-4 py-2 border rounded-lg",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Cat\xe9gorie"}),(0,t.jsx)("input",{type:"text",name:"category",defaultValue:f.category,className:"w-full px-4 py-2 border rounded-lg",required:!0})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Sauvegarder"}),(0,t.jsx)("button",{type:"button",onClick:()=>{y(null),w(!1)},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Annuler"})]})]}),"drinks"===c&&"name"in f&&(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault();let r=new FormData(e.currentTarget);q({name:r.get("name"),description:r.get("description"),price:parseFloat(r.get("price")),category:r.get("category")})},className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nom"}),(0,t.jsx)("input",{type:"text",name:"name",defaultValue:f.name,className:"w-full px-4 py-2 border rounded-lg",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Description"}),(0,t.jsx)("textarea",{name:"description",defaultValue:f.description,className:"w-full px-4 py-2 border rounded-lg",rows:3})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Prix (CHF)"}),(0,t.jsx)("input",{type:"number",name:"price",step:"0.01",defaultValue:f.price,className:"w-full px-4 py-2 border rounded-lg",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Cat\xe9gorie"}),(0,t.jsxs)("select",{name:"category",defaultValue:f.category,className:"w-full px-4 py-2 border rounded-lg",required:!0,children:[(0,t.jsx)("option",{value:"cocktail",children:"Cocktail"}),(0,t.jsx)("option",{value:"wine",children:"Vin"}),(0,t.jsx)("option",{value:"beer",children:"Bi\xe8re"}),(0,t.jsx)("option",{value:"non-alcoholic",children:"Sans alcool"})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Sauvegarder"}),(0,t.jsx)("button",{type:"button",onClick:()=>{y(null),w(!1)},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Annuler"})]})]}),"gallery"===c&&"src"in f&&(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault();let r=new FormData(e.currentTarget);L({src:r.get("src"),alt:r.get("alt")})},className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"URL de l'image"}),(0,t.jsx)("input",{type:"text",name:"src",defaultValue:f.src,className:"w-full px-4 py-2 border rounded-lg",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Ou uploader une image"}),(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:A,className:"w-full px-4 py-2 border rounded-lg"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Description (alt)"}),(0,t.jsx)("input",{type:"text",name:"alt",defaultValue:f.alt,className:"w-full px-4 py-2 border rounded-lg",required:!0})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Sauvegarder"}),(0,t.jsx)("button",{type:"button",onClick:()=>{y(null),w(!1)},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Annuler"})]})]})]})})]})]}):(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Administration"}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"Papaz123123"===s?(r(!0),localStorage.setItem("admin_authenticated","true"),E()):alert("Mot de passe incorrect")},children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Mot de passe"}),(0,t.jsx)("input",{type:"password",value:s,onChange:e=>n(e.target.value),className:"w-full px-4 py-2 border rounded-lg",required:!0})]}),(0,t.jsx)("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700",children:"Se connecter"})]})]})})}},5919:(e,r,s)=>{"use strict";s.d(r,{NG:()=>i,R2:()=>u,TW:()=>p,V6:()=>h,Vd:()=>m,XR:()=>x,a1:()=>g,ax:()=>o,fb:()=>l,gL:()=>a,q2:()=>c,wW:()=>d,x2:()=>n});var t=s(3941);async function a(){let{data:e,error:r}=await t.N.from("menu_items").select("*").eq("is_active",!0).order("display_order",{ascending:!0}).order("category",{ascending:!0});return r?(console.error("Error fetching menu items:",r),[]):e.map(e=>({id:e.id,name:e.name,description:e.description||"",price:parseFloat(e.price),category:e.category,tags:e.tags||[]}))}async function i(){let{data:e,error:r}=await t.N.from("drink_items").select("*").eq("is_active",!0).order("display_order",{ascending:!0}).order("category",{ascending:!0});return r?(console.error("Error fetching drink items:",r),[]):e.map(e=>({id:e.id,name:e.name,description:e.description||"",price:parseFloat(e.price),category:e.category}))}async function l(){let{data:e,error:r}=await t.N.from("gallery_images").select("*").eq("is_active",!0).order("display_order",{ascending:!0});return r?(console.error("Error fetching gallery images:",r),[]):e.map(e=>({id:e.id,src:e.src,alt:e.alt}))}async function n(e){let{data:r,error:s}=await t.N.from("menu_items").insert({name:e.name,description:e.description,price:e.price,category:e.category,tags:e.tags||[]}).select().single();if(s)throw s;return r}async function c(e,r){let{data:s,error:a}=await t.N.from("menu_items").update({name:r.name,description:r.description,price:r.price,category:r.category,tags:r.tags}).eq("id",e).select().single();if(a)throw a;return s}async function o(e){let{error:r}=await t.N.from("menu_items").update({is_active:!1}).eq("id",e);if(r)throw r}async function d(e){let{data:r,error:s}=await t.N.from("drink_items").insert({name:e.name,description:e.description,price:e.price,category:e.category}).select().single();if(s)throw s;return r}async function u(e,r){let{data:s,error:a}=await t.N.from("drink_items").update({name:r.name,description:r.description,price:r.price,category:r.category}).eq("id",e).select().single();if(a)throw a;return s}async function m(e){let{error:r}=await t.N.from("drink_items").update({is_active:!1}).eq("id",e);if(r)throw r}async function g(e){let{data:r,error:s}=await t.N.from("gallery_images").insert({src:e.src,alt:e.alt}).select().single();if(s)throw s;return r}async function p(e,r){let{data:s,error:a}=await t.N.from("gallery_images").update({src:r.src,alt:r.alt}).eq("id",e).select().single();if(a)throw a;return s}async function x(e){let{error:r}=await t.N.from("gallery_images").update({is_active:!1}).eq("id",e);if(r)throw r}async function h(e,r){let{data:s,error:a}=await t.N.storage.from("gallery").upload(r,e,{cacheControl:"3600",upsert:!1});if(a)throw console.error("Erreur upload:",a),a;if(!s)throw Error("Aucune donn\xe9e retourn\xe9e lors de l'upload");let{data:{publicUrl:i}}=t.N.storage.from("gallery").getPublicUrl(s.path);return i}}},e=>{e.O(0,[373,441,255,358],()=>e(e.s=3073)),_N_E=e.O()}]);